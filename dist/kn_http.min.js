/**
 * KnHttp v1.0.6 (2023-12-16 11:37:08 +0100)
 * Copyright (c) 2022 - 2023 Florent VIALATTE
 * Released under the MIT license
 */
'use strict';const KnHttp=function(){const e={validateStatus:function(e){return 200==e},timeout:27e4,basicAuth:null,bearerAuthToken:null,withCredentials:!1,requestType:'raw',responseType:'json',csrfHeader:'X-CSRF',headers:{Accept:'*/*','X-Requested-With':'XMLHttpRequest'}};class r{constructor(){this._xhr=new XMLHttpRequest}abort(){this._xhr&&4!=this._xhr.readyState&&this._xhr.abort()}progress(){this._onProgress&&this._onProgress.apply(null,arguments)}success(){this._onSuccess&&this._onSuccess.apply(null,arguments),this._onEnd&&this._onEnd(),this._xhr&&(this._xhr=null)}error(){this._onError&&this._onError.apply(null,arguments),this._onEnd&&this._onEnd(),this._xhr&&(this._xhr=null)}onProgress(e){return this._onProgress=e,this}onSuccess(e){return this._onSuccess=e,this}onError(e){return this._onError=e,this}onEnd(e){return this._onEnd=e,this}}function t(t,n,u){const a=new r;u||(u={}),void 0===u.timeout&&(u.timeout=e.timeout),u.requestType||(u.requestType=e.requestType),u.responseType||(u.responseType=e.responseType),u.headers||(u.headers={}),u.download||(u.download=!1),u.upload||(u.upload=!1),u.withCredentials||(u.withCredentials=e.withCredentials),u.basicAuth||(u.basicAuth=e.basicAuth),u.bearerAuthToken||(u.bearerAuthToken=e.bearerAuthToken),u.csrfHeader||(u.csrfHeader=e.csrfHeader),u.csrf||(u.csrf=null),u.body||(u.body=null);const i={};for(const e in u.headers)i[e.trim().toLowerCase()]=u.headers[e];for(const r in e.headers){const t=r.trim().toLowerCase();void 0===i[t]&&(i[t]=e.headers[r])}a._xhr.open(n.toUpperCase(),t,!0),a._xhr.timeout=u.timeout,a._xhr.withCredentials=u.withCredentials,u.basicAuth&&a._xhr.setRequestHeader('Authorization','Basic '+window.btoa((u.basicAuth.username||'')+':'+(u.basicAuth.password||''))),u.bearerAuthToken&&a._xhr.setRequestHeader('Authorization','Bearer '+u.bearerAuthToken),u.csrf&&a._xhr.setRequestHeader(u.csrfHeader,u.csrf);for(const e in i)a._xhr.setRequestHeader(e,i[e]);if(a._xhr.responseType=u.responseType,a._xhr.onloadend=r=>{if(a._xhr)if(e.validateStatus(a._xhr.status)){let e=function(e){const r={};return e.trim().split(/[\r\n]+/).forEach((e=>{const t=e.split(': '),o=t.shift(),s=t.join(': ');r[o]=s})),r}(a._xhr.getAllResponseHeaders());u.download&&'blob'==u.responseType?(function(e,r){const t=window.URL.createObjectURL(e),o=document.createElement('a');o.href=t,o.setAttribute('download',r),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(t)}(a._xhr.response,function(e,r){let t;if(e&&-1!==e.indexOf('attachment')){let r=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(e);null!=r&&r[1]&&(t=r[1].replace(/['"]/g,''))}return t||(t=r.substring(r.lastIndexOf('/')+1).split(/[?#]/)[0]),t||(t='download'),decodeURIComponent(t)}(a._xhr.getResponseHeader('content-disposition'),t)),a.success(!0,e)):'json'!=u.responseType||a._xhr.response?a.success(a._xhr.response,e):a.error(2,a._xhr.status)}else a.error(1,a._xhr.status)},a._xhr.onerror=e=>{a._xhr&&a.error(0,a._xhr.status)},a._xhr.ontimeout=e=>{a._xhr&&a.error(2,a._xhr.status)},a._xhr.onabort=e=>{a._xhr&&a.error(-1,a._xhr.status)},u.download&&(a._xhr.onprogress=e=>{a._xhr&&a.progress(e.lengthComputable?Math.floor(e.loaded/e.total*100):-1)}),u.upload&&(a._xhr.upload.onprogress=e=>{a._xhr&&a.progress(e.lengthComputable?Math.floor(e.loaded/e.total*100):-1)},a._xhr.upload.onerror=e=>{a._xhr&&a.error(0,a._xhr.status)}),u.body)switch(u.requestType){case'json':a._xhr.setRequestHeader('Content-Type','application/json'),u.body=JSON.stringify(u.body);break;case'form':a._xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded'),u.body=o(u.body);break;case'formData':u.body=s(u.body)}return a._xhr.send(u.body||null),a}function o(e,r){if(r){if(e.constructor===Array&&0==e.length||e.constructor===Object&&0==Object.keys(e).length)return r}else if(e.constructor===Array)throw'';const t=[];for(let s in e){const n=null==e[s]?'':e[s];e.constructor===Array?s=`${r}[${s}]`:e.constructor===Object&&(s=r?`${r}[${s}]`:s),'object'==typeof n?t.push(o(n,s)):t.push(`${s}=${encodeURIComponent(n)}`)}return t.join('&')}function s(e,r,t){if(r){if(e.constructor===Array&&0==e.length||e.constructor===Object&&0==Object.keys(e).length)return void t.append(r,"")}else if(e.constructor===Array)throw'';t=t||new FormData;for(let o in e){const n=null==e[o]?'':e[o];e.constructor===Array?o=`${r}[${o}]`:e.constructor===Object&&(o=r?`${r}[${o}]`:o),'object'==typeof n?s(n,o,t):t.append(o,n)}return t}return{VERSION:'1.0.6',DEFAULTS:e,CANCELED_ERROR:-1,NETWORK_ERROR:0,HTTP_ERROR:1,UNKNOWN_ERROR:2,get:function(e,r){return t(e,'GET',r)},getText:function(e,r){return r||(r={}),r.responseType='text',t(e,'GET',r)},del:function(e,r){return t(e,'DELETE',r)},download:function(e,r){return r||(r={}),r.download=!0,r.responseType='blob',t(e,'GET',r)},postRaw:function(e,r,o){return o||(o={}),o.body=r,o.requestType='raw',t(e,'POST',o)},postForm:function(e,r,o){return o||(o={}),o.body=r,o.requestType='form',t(e,'POST',o)},postFormData:function(e,r,o){return o||(o={}),o.body=r,o.requestType='formData',t(e,'POST',o)},postJson:function(e,r,o){return o||(o={}),o.body=r,o.requestType='json',t(e,'POST',o)},request:t}}();
