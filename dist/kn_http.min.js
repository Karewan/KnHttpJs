/**
 * KnHttp v1.0.0 (2022-12-08 21:40:24 +0100)
 * Copyright (c) 2022 Florent VIALATTE
 * Released under the MIT license
 */
'use strict';const KnHttp=function(){const e={validateStatus:function(e){return 200==e},timeout:27e4,basicAuth:null,bearerAuthToken:null,withCredentials:!1,requestType:'raw',responseType:'json',csrfHeader:'X-CSRF',headers:{Accept:'*/*','X-Requested-With':'XMLHttpRequest'}};function t(){this._xhr=new XMLHttpRequest}function r(r,s,u){const i=new t;u||(u={}),void 0===u.timeout&&(u.timeout=e.timeout),u.requestType||(u.requestType=e.requestType),u.responseType||(u.responseType=e.responseType),u.headers||(u.headers={}),u.download||(u.download=!1),u.upload||(u.upload=!1),u.withCredentials||(u.withCredentials=e.withCredentials),u.basicAuth||(u.basicAuth=e.basicAuth),u.bearerAuthToken||(u.bearerAuthToken=e.bearerAuthToken),u.csrfHeader||(u.csrfHeader=e.csrfHeader),u.csrf||(u.csrf=null),u.body||(u.body=null);const a={};for(const e in u.headers)a[e.trim().toLowerCase()]=u.headers[e];for(const t in e.headers){const r=t.trim().toLowerCase();void 0===a[r]&&(a[r]=e.headers[t])}i._xhr.open(s.toUpperCase(),r,!0),i._xhr.timeout=u.timeout,i._xhr.withCredentials=u.withCredentials,u.basicAuth&&i._xhr.setRequestHeader('Authorization','Basic '+window.btoa((u.basicAuth.username||'')+':'+(u.basicAuth.password||''))),u.bearerAuthToken&&i._xhr.setRequestHeader('Authorization','Bearer '+u.bearerAuthToken),u.csrf&&i._xhr.setRequestHeader(u.csrfHeader,u.csrf);for(const e in a)i._xhr.setRequestHeader(e,a[e]);if(i._xhr.responseType=u.responseType,i._xhr.onloadend=t=>{if(i._xhr)if(e.validateStatus(i._xhr.status)){let e=function(e){const t={};return e.trim().split(/[\r\n]+/).forEach((e=>{const r=e.split(': '),o=r.shift(),n=r.join(': ');t[o]=n})),t}(i._xhr.getAllResponseHeaders());u.download&&'blob'==u.responseType?(function(e,t){const r=window.URL.createObjectURL(e),o=document.createElement('a');o.href=r,o.setAttribute('download',t),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(r)}(i._xhr.response,function(e,t){let r;if(e&&-1!==e.indexOf('attachment')){let t=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(e);null!=t&&t[1]&&(r=t[1].replace(/['"]/g,''))}return r||(r=t.substring(t.lastIndexOf('/')+1)),r||(r='download'),r}(i._xhr.getResponseHeader('content-disposition'),r)),i.success(!0,e)):i.success(i._xhr.response,e)}else i.error(1,i._xhr.status)},i._xhr.onerror=e=>{i._xhr&&i.error(0,i._xhr.status)},i._xhr.ontimeout=e=>{i._xhr&&i.error(2,i._xhr.status)},i._xhr.onabort=e=>{i._xhr&&i.error(-1,i._xhr.status)},u.download&&(i._xhr.onprogress=e=>{i._xhr&&i.progress(e.lengthComputable?Math.floor(e.loaded/e.total*100):-1)}),u.upload&&(i._xhr.upload.onprogress=e=>{i._xhr&&i.progress(e.lengthComputable?Math.floor(e.loaded/e.total*100):-1)},i._xhr.upload.onerror=e=>{i._xhr&&i.error(0,i._xhr.status)}),u.body)switch(u.requestType){case'json':i._xhr.setRequestHeader('Content-Type','application/json'),u.body=JSON.stringify(u.body);break;case'form':i._xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded'),u.body=o(u.body);break;case'formData':u.body=n(u.body)}return i._xhr.send(u.body||null),i}function o(e,t){if(t){if(e.constructor===Array&&0==e.length||e.constructor===Object&&0==Object.keys(e).length)return t}else if(e.constructor===Array)throw'';const r=[];for(let n in e){const s=null==e[n]?'':e[n];e.constructor===Array?n=`${t}[]`:e.constructor===Object&&(n=t?`${t}[${n}]`:n),'object'==typeof s?r.push(o(s,n)):r.push(`${n}=${encodeURIComponent(s)}`)}return r.join('&')}function n(e,t,r){if(t){if(e.constructor===Array&&0==e.length||e.constructor===Object&&0==Object.keys(e).length)return void r.append(t,"")}else if(e.constructor===Array)throw'';r=r||new FormData;for(let o in e){const s=null==e[o]?'':e[o];e.constructor===Array?o=`${t}[]`:e.constructor===Object&&(o=t?`${t}[${o}]`:o),'object'==typeof s?n(s,o,r):r.append(o,s)}return r}return t.prototype={abort:function(){this._xhr&&this._xhr.abort()},progress:function(){this._onProgress&&this._onProgress.apply(null,arguments)},success:function(){this._onSuccess&&this._onSuccess.apply(null,arguments),this._onEnd&&this._onEnd(),this._xhr&&(this._xhr=null)},error:function(){this._onError&&this._onError.apply(null,arguments),this._onEnd&&this._onEnd(),this._xhr&&(this._xhr=null)},onProgress:function(e){return this._onProgress=e,this},onSuccess:function(e){return this._onSuccess=e,this},onError:function(e){return this._onError=e,this},onEnd:function(e){return this._onEnd=e,this}},{VERSION:'1.0.0',DEFAULTS:e,CANCELED_ERROR:-1,NETWORK_ERROR:0,HTTP_ERROR:1,UNKNOWN_ERROR:2,get:function(e,t){return r(e,'GET',t)},getText:function(e,t){return t||(t={}),t.responseType='text',r(e,'GET',t)},del:function(e,t){return r(e,'DELETE',t)},download:function(e,t){return t||(t={}),t.download=!0,t.responseType='blob',r(e,'GET',t)},postRaw:function(e,t,o){return o||(o={}),o.body=t,o.requestType='raw',r(e,'POST',o)},postForm:function(e,t,o){return o||(o={}),o.body=t,o.requestType='form',r(e,'POST',o)},postFormData:function(e,t,o){return o||(o={}),o.body=t,o.requestType='formData',r(e,'POST',o)},postJson:function(e,t,o){return o||(o={}),o.body=t,o.requestType='json',r(e,'POST',o)},request:r}}();
