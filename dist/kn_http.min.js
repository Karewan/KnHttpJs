/**
 * KnHttp v1.0.4 (2023-09-18 12:42:58 +0200)
 * Copyright (c) 2022 - 2023 Florent VIALATTE
 * Released under the MIT license
 */
'use strict';const KnHttp=function(){const e={validateStatus:function(e){return 200==e},timeout:27e4,basicAuth:null,bearerAuthToken:null,withCredentials:!1,requestType:'raw',responseType:'json',csrfHeader:'X-CSRF',headers:{Accept:'*/*','X-Requested-With':'XMLHttpRequest'}};function r(){this._xhr=new XMLHttpRequest}function t(t,s,u){const i=new r;u||(u={}),void 0===u.timeout&&(u.timeout=e.timeout),u.requestType||(u.requestType=e.requestType),u.responseType||(u.responseType=e.responseType),u.headers||(u.headers={}),u.download||(u.download=!1),u.upload||(u.upload=!1),u.withCredentials||(u.withCredentials=e.withCredentials),u.basicAuth||(u.basicAuth=e.basicAuth),u.bearerAuthToken||(u.bearerAuthToken=e.bearerAuthToken),u.csrfHeader||(u.csrfHeader=e.csrfHeader),u.csrf||(u.csrf=null),u.body||(u.body=null);const a={};for(const e in u.headers)a[e.trim().toLowerCase()]=u.headers[e];for(const r in e.headers){const t=r.trim().toLowerCase();void 0===a[t]&&(a[t]=e.headers[r])}i._xhr.open(s.toUpperCase(),t,!0),i._xhr.timeout=u.timeout,i._xhr.withCredentials=u.withCredentials,u.basicAuth&&i._xhr.setRequestHeader('Authorization','Basic '+window.btoa((u.basicAuth.username||'')+':'+(u.basicAuth.password||''))),u.bearerAuthToken&&i._xhr.setRequestHeader('Authorization','Bearer '+u.bearerAuthToken),u.csrf&&i._xhr.setRequestHeader(u.csrfHeader,u.csrf);for(const e in a)i._xhr.setRequestHeader(e,a[e]);if(i._xhr.responseType=u.responseType,i._xhr.onloadend=r=>{if(i._xhr)if(e.validateStatus(i._xhr.status)){let e=function(e){const r={};return e.trim().split(/[\r\n]+/).forEach((e=>{const t=e.split(': '),o=t.shift(),n=t.join(': ');r[o]=n})),r}(i._xhr.getAllResponseHeaders());u.download&&'blob'==u.responseType?(function(e,r){const t=window.URL.createObjectURL(e),o=document.createElement('a');o.href=t,o.setAttribute('download',r),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(t)}(i._xhr.response,function(e,r){let t;if(e&&-1!==e.indexOf('attachment')){let r=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(e);null!=r&&r[1]&&(t=r[1].replace(/['"]/g,''))}return t||(t=r.substring(r.lastIndexOf('/')+1).split(/[?#]/)[0]),t||(t='download'),decodeURIComponent(t)}(i._xhr.getResponseHeader('content-disposition'),t)),i.success(!0,e)):'json'!=u.responseType||i._xhr.response?i.success(i._xhr.response,e):i.error(2,i._xhr.status)}else i.error(1,i._xhr.status)},i._xhr.onerror=e=>{i._xhr&&i.error(0,i._xhr.status)},i._xhr.ontimeout=e=>{i._xhr&&i.error(2,i._xhr.status)},i._xhr.onabort=e=>{i._xhr&&i.error(-1,i._xhr.status)},u.download&&(i._xhr.onprogress=e=>{i._xhr&&i.progress(e.lengthComputable?Math.floor(e.loaded/e.total*100):-1)}),u.upload&&(i._xhr.upload.onprogress=e=>{i._xhr&&i.progress(e.lengthComputable?Math.floor(e.loaded/e.total*100):-1)},i._xhr.upload.onerror=e=>{i._xhr&&i.error(0,i._xhr.status)}),u.body)switch(u.requestType){case'json':i._xhr.setRequestHeader('Content-Type','application/json'),u.body=JSON.stringify(u.body);break;case'form':i._xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded'),u.body=o(u.body);break;case'formData':u.body=n(u.body)}return i._xhr.send(u.body||null),i}function o(e,r){if(r){if(e.constructor===Array&&0==e.length||e.constructor===Object&&0==Object.keys(e).length)return r}else if(e.constructor===Array)throw'';const t=[];for(let n in e){const s=null==e[n]?'':e[n];e.constructor===Array?n=`${r}[${n}]`:e.constructor===Object&&(n=r?`${r}[${n}]`:n),'object'==typeof s?t.push(o(s,n)):t.push(`${n}=${encodeURIComponent(s)}`)}return t.join('&')}function n(e,r,t){if(r){if(e.constructor===Array&&0==e.length||e.constructor===Object&&0==Object.keys(e).length)return void t.append(r,"")}else if(e.constructor===Array)throw'';t=t||new FormData;for(let o in e){const s=null==e[o]?'':e[o];e.constructor===Array?o=`${r}[${o}]`:e.constructor===Object&&(o=r?`${r}[${o}]`:o),'object'==typeof s?n(s,o,t):t.append(o,s)}return t}return r.prototype={abort:function(){this._xhr&&this._xhr.abort()},progress:function(){this._onProgress&&this._onProgress.apply(null,arguments)},success:function(){this._onSuccess&&this._onSuccess.apply(null,arguments),this._onEnd&&this._onEnd(),this._xhr&&(this._xhr=null)},error:function(){this._onError&&this._onError.apply(null,arguments),this._onEnd&&this._onEnd(),this._xhr&&(this._xhr=null)},onProgress:function(e){return this._onProgress=e,this},onSuccess:function(e){return this._onSuccess=e,this},onError:function(e){return this._onError=e,this},onEnd:function(e){return this._onEnd=e,this}},{VERSION:'1.0.4',DEFAULTS:e,CANCELED_ERROR:-1,NETWORK_ERROR:0,HTTP_ERROR:1,UNKNOWN_ERROR:2,get:function(e,r){return t(e,'GET',r)},getText:function(e,r){return r||(r={}),r.responseType='text',t(e,'GET',r)},del:function(e,r){return t(e,'DELETE',r)},download:function(e,r){return r||(r={}),r.download=!0,r.responseType='blob',t(e,'GET',r)},postRaw:function(e,r,o){return o||(o={}),o.body=r,o.requestType='raw',t(e,'POST',o)},postForm:function(e,r,o){return o||(o={}),o.body=r,o.requestType='form',t(e,'POST',o)},postFormData:function(e,r,o){return o||(o={}),o.body=r,o.requestType='formData',t(e,'POST',o)},postJson:function(e,r,o){return o||(o={}),o.body=r,o.requestType='json',t(e,'POST',o)},request:t}}();
